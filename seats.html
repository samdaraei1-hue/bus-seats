<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Bus Seating Map</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #000000;
        padding: 20px;
    }

    h2 {
        text-align: center;
    }

    .row {
        display: flex;
        justify-content: center;
        margin-bottom: 10px;
        gap: 10px;
    }

    .seat {
        width: 48px;
        height: 48px;
        border-radius: 6px;
        background: yellow;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        border: 1px solid #777;
        position: relative;
    }

    .taken {
        background: #e74c3c;
        color: white;
    }

.label {
    font-size: 10px;
    position: absolute;
    top: 50px;
    left: 50%;
    transform: translateX(-50%);
    white-space: nowrap;
    background-color: rgba(0,0,0,0.7); /* پس‌زمینه مشکی شفاف */
    color: white; /* رنگ متن */
    padding: 2px 4px;
    border-radius: 3px;
}


    .gap {
        width: 40px;
    }

    .controls {
        text-align: center;
        margin: 20px;
    }

    button {
        padding: 8px 16px;
        margin: 0 5px;
        font-size: 16px;
    }
</style>
</head>
<body>

<h2 id="busTitle" style="background-color:white; padding:10px; border-radius:6px; text-align:center;">Bus Seat Map - Bus 1</h2>
<div id="bus" style="background-color:white; padding:15px; border-radius:6px;"></div

<div class="controls">
    <button id="prevBus">Previous Bus</button>
    <button id="nextBus">Next Bus</button>
</div>

<script>
const busCapacities = { 1: 60, 2: 55, 3: 53, 4: 51 };
let selectedBus = 1;

function parseCSV(text) {
    const lines = text.trim().split("\n");
    const headers = lines[0].split(",");
    return lines.slice(1).map(line => {
        const values = line.split(",");
        const obj = {};
        headers.forEach((h, i) => obj[h] = values[i]);
        return obj;
    });
}

async function loadCSV() {
    const res = await fetch("seats.csv");
    const text = await res.text();
    return parseCSV(text);
}

function buildSeatList(rows) {
    let reserved = {};
    rows.forEach(r => {
        if (parseInt(r.bus) === selectedBus) {
            reserved[parseInt(r.seat)] = r.name;
        }
    });
    return reserved;
}

function makeSeat(num, name) {
    const div = document.createElement("div");
    div.className = "seat" + (name ? " taken" : "");
    div.textContent = num;
    if (name) {
        const lbl = document.createElement("div");
        lbl.className = "label";
        lbl.textContent = name;
        div.appendChild(lbl);
    }
    return div;
}

function renderBus(reserved) {
    const total = busCapacities[selectedBus];
    const busDiv = document.getElementById("bus");
    busDiv.innerHTML = "";
    document.getElementById("busTitle").textContent = `Bus Seat Map - Bus ${selectedBus}`;

    let seats = [];
    for (let i = 1; i <= total; i++) {
        seats.push({num: i, name: reserved[i] || null});
    }

    // جای 26 و 27 را با gap دوخانه‌ای خالی می‌کنیم و صندلی‌ها بعد از آن شیفت پیدا می‌کنند
    const gapIndex = 25; // صندلی 26
    seats.splice(gapIndex, 0, {num: null}, {num: null}); // دو خانه خالی

    let s = 0;

    // ردیف اول (5 صندلی)
    const row1 = document.createElement("div");
    row1.className = "row";
    for (let i = 0; i < 5 && s < seats.length; i++, s++) {
        if (seats[s].num !== null) row1.appendChild(makeSeat(seats[s].num, seats[s].name));
        else {
            const empty = document.createElement("div");
            empty.className = "seat";
            empty.style.background = "transparent";
            empty.style.border = "none";
            row1.appendChild(empty);
        }
    }
    busDiv.appendChild(row1);

    // ردیف‌های بعدی (2 + gap + 2)
    while (s < seats.length) {
        const row = document.createElement("div");
        row.className = "row";

        // سمت چپ 2 صندلی
        for (let i = 0; i < 2 && s < seats.length; i++, s++) {
            if (seats[s].num !== null) row.appendChild(makeSeat(seats[s].num, seats[s].name));
            else {
                const empty = document.createElement("div");
                empty.className = "seat";
                empty.style.background = "transparent";
                empty.style.border = "none";
                row.appendChild(empty);
            }
        }

        // دالان
        const gapDiv = document.createElement("div");
        gapDiv.className = "gap";
        row.appendChild(gapDiv);

        // سمت راست 2 صندلی
        for (let i = 0; i < 2 && s < seats.length; i++, s++) {
            if (seats[s].num !== null) row.appendChild(makeSeat(seats[s].num, seats[s].name));
            else {
                const empty = document.createElement("div");
                empty.className = "seat";
                empty.style.background = "transparent";
                empty.style.border = "none";
                row.appendChild(empty);
            }
        }

        busDiv.appendChild(row);
    }
}

async function main() {
    const csv = await loadCSV();
    window.csvData = csv;
    renderBus(buildSeatList(csv));
}

document.getElementById("nextBus").addEventListener("click", () => {
    selectedBus++;
    if (selectedBus > Object.keys(busCapacities).length) selectedBus = 1;
    renderBus(buildSeatList(window.csvData));
});

document.getElementById("prevBus").addEventListener("click", () => {
    selectedBus--;
    if (selectedBus < 1) selectedBus = Object.keys(busCapacities).length;
    renderBus(buildSeatList(window.csvData));
});

main();
</script>

</body>
</html>



