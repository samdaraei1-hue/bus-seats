<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Bus Seating Map</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        padding: 20px;
    }

    h2 {
        text-align: center;
    }

    .row {
        display: flex;
        justify-content: center;
        margin-bottom: 10px;
        gap: 10px;
    }

    .seat {
        width: 48px;
        height: 48px;
        border-radius: 6px;
        background: yellow;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        border: 1px solid #777;
        position: relative;
    }

    .taken {
        background: #e74c3c;
        color: white;
    }

    .label {
        font-size: 11px;
        position: absolute;
        top: 50px;
        left: 50%;
        transform: translateX(-50%);
        white-space: nowrap;
    }

    .gap {
        width: 40px;
    }
</style>
</head>
<body>

<h2>Bus Seat Map</h2>
<div id="bus"></div>

<script>
/* -------------------------------
   ظرفیت اتوبوس‌ها
-------------------------------- */
const busCapacities = {
    1: 60,
    2: 55,
    3: 53,
    4: 51
};

// اتوبوسی که می‌خواهی نمایش داده شود
const selectedBus = 1;

/* -------------------------------
   CSV Parser
-------------------------------- */
function parseCSV(text) {
    const lines = text.trim().split("\n");
    const headers = lines[0].split(",");

    return lines.slice(1).map(line => {
        const values = line.split(",");
        const obj = {};
        headers.forEach((h, i) => obj[h] = values[i]);
        return obj;
    });
}

/* -------------------------------
   خواندن فایل seats.csv
-------------------------------- */
async function loadCSV() {
    const res = await fetch("seats.csv");
    const text = await res.text();
    return parseCSV(text);
}

/* -------------------------------
   تولید صندلی‌ها از CSV
-------------------------------- */
function buildSeatList(rows) {
    let reserved = {};

    rows.forEach(r => {
        if (parseInt(r.bus) === selectedBus) {
            reserved[parseInt(r.seat)] = r.name;
        }
    });

    return reserved;
}

/* -------------------------------
   رسم صندلی
-------------------------------- */
function makeSeat(num, name) {
    const div = document.createElement("div");
    div.className = "seat" + (name ? " taken" : "");
    div.textContent = num;

    if (name) {
        const lbl = document.createElement("div");
        lbl.className = "label";
        lbl.textContent = name;
        div.appendChild(lbl);
    }
    return div;
}

/* -------------------------------
   رسم کل اتوبوس
   قوانین:
   - ردیف 1 → پنج‌تایی
   - بقیه → 2 + فاصله + 2
   - آخر → هرچقدر باقی ماند، در ردیف مستقل
-------------------------------- */
function renderBus(reserved) {
    const total = busCapacities[selectedBus];
    const busDiv = document.getElementById("bus");

    let s = 1;

    // ردیف اول
    const row1 = document.createElement("div");
    row1.className = "row";
    for (let i = 0; i < 5 && s <= total; i++) {
        row1.appendChild(makeSeat(s, reserved[s]));
        s++;
    }
    busDiv.appendChild(row1);

    // ردیف‌های بعد
    while (s <= total) {
        const row = document.createElement("div");
        row.className = "row";

        // صندلی سمت چپ (2 صندلی)
        for (let i = 0; i < 2 && s <= total; i++) {
            row.appendChild(makeSeat(s, reserved[s]));
            s++;
        }

        // دالان
        const gap = document.createElement("div");
        gap.className = "gap";
        row.appendChild(gap);

        // صندلی سمت راست (2 صندلی)
        for (let i = 0; i < 2 && s <= total; i++) {
            row.appendChild(makeSeat(s, reserved[s]));
            s++;
        }

        busDiv.appendChild(row);
    }
}

/* -------------------------------
   اجرای اصلی
-------------------------------- */
async function main() {
    const csv = await loadCSV();
    const reserved = buildSeatList(csv);
    renderBus(reserved);
}

main();
</script>

</body>
</html>
