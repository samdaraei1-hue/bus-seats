<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Bus Seating Map</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        padding: 20px;
    }

    h2 {
        text-align: center;
    }

    .row {
        display: flex;
        justify-content: center;
        margin-bottom: 10px;
        gap: 10px;
    }

    .seat {
        width: 48px;
        height: 48px;
        border-radius: 6px;
        background: yellow;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        border: 1px solid #777;
        position: relative;
    }

    .taken {
        background: #e74c3c;
        color: white;
    }

    .label {
        font-size: 11px;
        position: absolute;
        top: 50px;
        left: 50%;
        transform: translateX(-50%);
        white-space: nowrap;
    }

    .gap {
        width: 40px;
    }

    .controls {
        text-align: center;
        margin: 20px;
    }

    button {
        padding: 8px 16px;
        margin: 0 5px;
        font-size: 16px;
    }
</style>
</head>
<body>

<h2 id="busTitle">Bus Seat Map - Bus 1</h2>
<div id="bus"></div>

<div class="controls">
    <button id="prevBus">Previous Bus</button>
    <button id="nextBus">Next Bus</button>
</div>

<script>
const busCapacities = { 1: 60, 2: 55, 3: 53, 4: 51 };
let selectedBus = 1;

function parseCSV(text) {
    const lines = text.trim().split("\n");
    const headers = lines[0].split(",");
    return lines.slice(1).map(line => {
        const values = line.split(",");
        const obj = {};
        headers.forEach((h, i) => obj[h] = values[i]);
        return obj;
    });
}

async function loadCSV() {
    const res = await fetch("seats.csv");
    const text = await res.text();
    return parseCSV(text);
}

function buildSeatList(rows) {
    let reserved = {};
    rows.forEach(r => {
        if (parseInt(r.bus) === selectedBus) {
            reserved[parseInt(r.seat)] = r.name;
        }
    });
    return reserved;
}

function makeSeat(num, name) {
    const div = document.createElement("div");
    div.className = "seat" + (name ? " taken" : "");
    div.textContent = num;
    if (name) {
        const lbl = document.createElement("div");
        lbl.className = "label";
        lbl.textContent = name;
        div.appendChild(lbl);
    }
    return div;
}

function renderBus(reserved) {
    const total = busCapacities[selectedBus];
    const busDiv = document.getElementById("bus");
    busDiv.innerHTML = ""; // پاک کردن قبلی
    document.getElementById("busTitle").textContent = `Bus Seat Map - Bus ${selectedBus}`;

    let s = 1;

    // ردیف اول (پنج‌تایی)
    const row1 = document.createElement("div");
    row1.className = "row";
    for (let i = 0; i < 5 && s <= total; i++) {
        if (s !== 26 && s !== 27) row1.appendChild(makeSeat(s, reserved[s]));
        s++;
    }
    busDiv.appendChild(row1);

    // بقیه ردیف‌ها (2 + gap + 2)
    while (s <= total) {
        if (s === 26 || s === 27) { s++; continue; } // رد کردن 26 و 27

        const row = document.createElement("div");
        row.className = "row";

        for (let i = 0; i < 2 && s <= total; i++) {
            if (s !== 26 && s !== 27) row.appendChild(makeSeat(s, reserved[s]));
            s++;
        }

        const gap = document.createElement("div");
        gap.className = "gap";
        row.appendChild(gap);

        for (let i = 0; i < 2 && s <= total; i++) {
            if (s !== 26 && s !== 27) row.appendChild(makeSeat(s, reserved[s]));
            s++;
        }

        busDiv.appendChild(row);
    }
}

async function main() {
    const csv = await loadCSV();
    window.csvData = csv; // نگه داشتن CSV برای استفاده دوباره
    renderBus(buildSeatList(csv));
}

document.getElementById("nextBus").addEventListener("click", () => {
    selectedBus++;
    if (selectedBus > Object.keys(busCapacities).length) selectedBus = 1;
    renderBus(buildSeatList(window.csvData));
});

document.getElementById("prevBus").addEventListener("click", () => {
    selectedBus--;
    if (selectedBus < 1) selectedBus = Object.keys(busCapacities).length;
    renderBus(buildSeatList(window.csvData));
});

main();
</script>

</body>
</html>
